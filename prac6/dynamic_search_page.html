<!DOCTYPE html>
<html>
	<head>
		<title>Dynamic Search Page</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6cufLFhHezckUrRhYOv_IV_EZ-g7cPeg&sensor=SET_TO_TRUE_OR_FALSE"></script>
		
		<script>
		var geocoder;
		var map;
		var marker=[];

		
		function showResults(str) {
			var xmlhttp;    
			if (str=="")
			  {
			  document.getElementById("resultsText").innerHTML="";
			  initialize();
			  //return;
			  }

			if (window.XMLHttpRequest) {
			// code for IE7+, Firefox, Chrome, Opera, Safari
			  xmlhttp=new XMLHttpRequest();
			}
			else{
			// code for IE6, IE5
			  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
			}


			xmlhttp.onreadystatechange=function() {
				if (xmlhttp.readyState==4 && xmlhttp.status==200) {
			    	document.getElementById("resultsText").innerHTML=xmlhttp.responseText;
			    	place_marker(str);
			    }
			}
			xmlhttp.open("GET","dynamic_search.jsp?q="+str,true);
			xmlhttp.send();
		}


		function initialize() {
	     	geocoder = new google.maps.Geocoder();
	     	var mapOptions = {
	        	center: new google.maps.LatLng(-27.470851, 153.023336),
	          	zoom: 13
	        };
	        map = new google.maps.Map(document.getElementById("map-canvas2"),
	            mapOptions);
	    }


		function place_marker(id) {
			initialize();
			var xmlhttp;   
			if (window.XMLHttpRequest) {
			// code for IE7+, Firefox, Chrome, Opera, Safari
			  xmlhttp=new XMLHttpRequest();
			}
			else{
			// code for IE6, IE5
			  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
			}

			xmlhttp.onreadystatechange=function() {
				if (xmlhttp.readyState==4 && xmlhttp.status==200) {
			    	var location_results = xmlhttp.responseText;
			    	console.log(location_results);
			   		if (location_results == "empty") {
			   			initialize();
			   		} else {
			    	var arrayOfLocations = location_results.split("#");
			    	place_marker2(arrayOfLocations);
			    	}
			    }
			    
			}
			xmlhttp.open("GET","location2.jsp?q="+id,true);
			xmlhttp.send();
		}




	    function place_marker2(location_names) {
	    	initialize();
	    	for (var i=0; i<location_names.length; i++){
	    		var address = location_names[i];
		  		geocoder.geocode( { 'address': address}, function(results, status) {
				    if (status == google.maps.GeocoderStatus.OK) {
				     	map.setCenter(results[0].geometry.location);
				       	marker = new google.maps.Marker({
				        	map: map,
				         	position: results[0].geometry.location
				      });
				    } else {
			     		//alert('Geocode was not successful for the following reason: ' + status);
			    	}
		  		});
	    	}
	    }


	    function splitString(stringToSplit, separator) {
			var arrayOfStrings = stringToSplit.split(separator);
		}



		</script>
	</head>



	<body onload="initialize()">
		<div class="wrapper">
			<div class="site_title">
				<img id="left_image" src="images/flankimages1.jpg" alt="loginimage">
				<a href = "http://infs3202-013.uqcloud.net/prac6/home.php">
					<img id="main_image" src="images/loginimage.jpg" alt="loginimage">
				</a>
				<img id="right_image" src="images/flankimages2.jpg" alt="loginimage">
			</div>

			<div id="login_details_tab">
				<a href="search_page.jsp"><h5>Custom Search |</h5></a>
				<a href="dynamic_search_page.html"><h5>| Quick Search</h5></a>
				</h4>
			</div>

			<div id="map-canvas2">
				Laoding map....
			</div>	


			<form id="dynamic_search_bar" action=""> 
				Keyword:  <input type="text" id="name" onkeyup="showResults(this.value)" /><br>
			</form>
			<br>
			<div id="resultsText">Search results will be listed here...</div>
		</div>	
	</body>
</html>
